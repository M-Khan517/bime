{% extends layout_path %}

{% load jalali_tags %}

{% load i18n %}

{% block title %}بیمه {{insurance.code}}{% endblock title %}

{% block content %}

<div class="content-wrapper">
                <!-- Content -->
                <div class="container-xxl flex-grow-1 container-p-y">
                    <div class="row invoice-preview">
                        <!-- Invoice -->
                        <div class="col-xl-9 col-md-8 col-12 mb-md-0 mb-4">
                            <div class="card invoice-preview-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between flex-xl-row flex-md-column flex-sm-row flex-column m-sm-3 m-0">
                                        <div class="mb-xl-0 mb-4">
                                            <div class="d-flex svg-illustration mb-4 gap-2 align-items-center">
                                                <div class="app-brand-logo demo">
                                                    {% if request.session.setting.logo == None %}
                                                    <svg fill="none" height="22" viewBox="0 0 32 22" width="32" xmlns="http://www.w3.org/2000/svg">
                                                        <path clip-rule="evenodd" d="M0.00172773 0V6.85398C0.00172773 6.85398 -0.133178 9.01207 1.98092 10.8388L13.6912 21.9964L19.7809 21.9181L18.8042 9.88248L16.4951 7.17289L9.23799 0H0.00172773Z" fill="#7367F0" fill-rule="evenodd"/>
                                                        <path clip-rule="evenodd" d="M7.69824 16.4364L12.5199 3.23696L16.5541 7.25596L7.69824 16.4364Z" fill="#161616" fill-rule="evenodd" opacity="0.06"/>
                                                        <path clip-rule="evenodd" d="M8.07751 15.9175L13.9419 4.63989L16.5849 7.28475L8.07751 15.9175Z" fill="#161616" fill-rule="evenodd" opacity="0.06"/>
                                                        <path clip-rule="evenodd" d="M7.77295 16.3566L23.6563 0H32V6.88383C32 6.88383 31.8262 9.17836 30.6591 10.4057L19.7824 22H13.6938L7.77295 16.3566Z" fill="#7367F0" fill-rule="evenodd"/>
                                                    </svg>
                                                    {% else %}
                                                    <img src="{{request.session.setting.logo}}" alt="logo">
                                                    {% endif %}
                                                </div>
                                                <span class="app-brand-text fw-bold fs-4">{% if request.session.setting.name %}بیمه زائر {% else %}{{request.session.setting.name}}{% endif %} </span>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="fw-medium mb-2">کدرهگیری:
                                                <bdi>#{{insurance.code}}</bdi>
                                            </h4>
                                            
                                            <div class="mb-2 pt-1">
                                                <span>تاریخ ایجاد:</span>
                                                <span class="fw-medium">{{insurance.created_at|to_jalali:'%y/%m/%d _ %H:%M:%S'}}</span>
                                            </div>
{% if insurance.pay_date %}
                                            <div class="pt-1">
                                                <span>تاریخ پرداخت:</span>
                                                <span class="fw-medium">{{insurance.pay_date|to_jalali:'%y/%m/%d _ %H:%M:%S'}}</span>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <hr class="my-0"/>
                                <div class="card-body">
                                    <div class="row p-sm-3 p-0">
                                        <div class="col-xl-6 col-md-12 col-sm-5 col-12 mb-xl-0 mb-md-4 mb-sm-0 mb-4">
                                            <h6 class="mb-3">مدیر کاروان:</h6>
                                            <p class="mb-1">{{insurance.manager.full_name}}</p>
                                            <p class="mb-1">{{insurance.manager.national_code}}</p>
                                            <p class="mb-1">
                                                <bdi>{{insurance.manager.phone}}</bdi>
                                            </p>
                                            {% if insurance.insurance_name %}
                                            <p class="mb-1">
                                                <bdi>{{insurance.insurance_name}}</bdi>
                                            </p>
                                            {% endif %}
                                        </div>
                                        <div class="col-xl-6 col-md-12 col-sm-7 col-12">
                                            <h6 class="mb-3">جزئیات :</h6>
                                            <table>
                                                <tbody>
                                                    {% if insurance.insurance_name %}
                                                    <tr>
                                                        <td class="pe-4">نام کاروان :</td>
                                                        <td>{{insurance.insurance_name}}</td>
                                                    </tr>
                                                    {% endif %}
                                                <tr>
                                                    <td class="pe-4">قابل پرداخت</td>
                                                    <td class="fw-medium">
                                                        <bdi><svg class="toman" width="1rem" height="1rem">
                                            <use xlink:href="#toman">
                                                <symbol id="toman" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
                                                    <path clip-rule="evenodd" d="M3.057 1.742L3.821 1l.78.75-.776.741-.768-.749zm3.23 2.48c0 .622-.16 1.111-.478 1.467-.201.221-.462.39-.783.505a3.251 3.251 0 01-1.083.163h-.555c-.421 0-.801-.074-1.139-.223a2.045 2.045 0 01-.9-.738A2.238 2.238 0 011 4.148c0-.059.001-.117.004-.176.03-.55.204-1.158.525-1.827l1.095.484c-.257.532-.397 1-.419 1.403-.002.04-.004.08-.004.12 0 .252.055.458.166.618a.887.887 0 00.5.354c.085.028.178.048.278.06.079.01.16.014.243.014h.555c.458 0 .769-.081.933-.244.14-.139.21-.383.21-.731V2.02h1.2v2.202zm5.433 3.184l-.72-.7.709-.706.735.707-.724.7zm-2.856.308c.542 0 .973.19 1.293.569.297.346.445.777.445 1.293v.364h.18v-.004h.41c.221 0 .377-.028.467-.084.093-.055.14-.14.14-.258v-.069c.004-.243.017-1.044 0-1.115L13 8.05v1.574a1.4 1.4 0 01-.287.863c-.306.405-.804.607-1.495.607h-.627c-.061.733-.434 1.257-1.117 1.573-.267.122-.58.21-.937.265a5.845 5.845 0 01-.914.067v-1.159c.612 0 1.072-.082 1.38-.247.25-.132.376-.298.376-.499h-.515c-.436 0-.807-.113-1.113-.339-.367-.273-.55-.667-.55-1.18 0-.488.122-.901.367-1.24.296-.415.728-.622 1.296-.622zm.533 2.226v-.364c0-.217-.048-.389-.143-.516a.464.464 0 00-.39-.187.478.478 0 00-.396.187.705.705 0 00-.136.449.65.65 0 00.003.067c.008.125.066.22.177.283.093.054.21.08.352.08h.533zM9.5 6.707l.72.7.724-.7L10.209 6l-.709.707zm-6.694 4.888h.03c.433-.01.745-.106.937-.29.024.012.065.035.12.068l.074.039.081.042c.135.073.261.133.379.18.345.146.67.22.977.22a1.216 1.216 0 00.87-.34c.3-.285.449-.714.449-1.286a2.19 2.19 0 00-.335-1.145c-.299-.457-.732-.685-1.3-.685-.502 0-.916.192-1.242.575-.113.132-.21.284-.294.456-.032.062-.06.125-.084.191a.504.504 0 00-.03.078 1.67 1.67 0 00-.022.06c-.103.309-.171.485-.205.53-.072.09-.214.14-.427.147-.123-.005-.209-.03-.256-.076-.057-.054-.085-.153-.085-.297V7l-1.201-.5v3.562c0 .261.048.496.143.703.071.158.168.296.29.413.123.118.266.211.43.28.198.084.42.13.665.136v.001h.036zm2.752-1.014a.778.778 0 00.044-.353.868.868 0 00-.165-.47c-.1-.134-.217-.201-.35-.201-.18 0-.33.103-.447.31-.042.071-.08.158-.114.262a2.434 2.434 0 00-.04.12l-.015.053-.015.046c.142.118.323.216.544.293.18.062.325.092.433.092.044 0 .086-.05.125-.152z" fill-rule="evenodd"></path>
                                                </symbol>
                                            </use>
                                        </svg>{{insurance.total_price}}</bdi>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="pe-4">مقصد:</td>
                                                    <td>{{insurance.destination}}</td>
                                                </tr>
                                                
                                                <tr>
                                                    <td class="pe-4">استان مبدا:</td>
                                                    <td>{{insurance.origin_province}}</td>
                                                </tr>
                                                {% if insurance.origin_county != None %}
                                                <tr>
                                                    <td class="pe-4">شهر مبدا:</td>
                                                    <td>{{insurance.origin_county}}</td>
                                                </tr>
                                                {% endif %}

                                                <tr>
                                                    <td class="pe-4">وضعیت:</td>
                                                    <td>{{insurance.get_status_display}}</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive border-top">
                                    {% if subsets %}
                                    <table class="table m-0">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>نام و نام خانوادگی زائر</th>
                                            <th>کد ملی</th>
                                        </tr>
                                        </thead>

                                        {% for sub in subsets %}
                                        <tr>
                                            <td>{{forloop.counter}}</td>
                                            <td>{{sub.full_name}}</td>
                                            <td>{{sub.national_code}}</td>
                                        </tr>
                                        {% endfor %}
                                        
                                        <tbody>
                                        
                                        </tbody>
                                    </table>
                                    {% endif %}
                                </div>
                                {% comment %} <div class="card-body mx-3">
                                    <div class="row">
                                        <div class="col-12">
                                            <span class="fw-medium">توضیحات خریدار:</span>
                                            <span>از کار کردن با شما و تیمتان لذت بردیم. امیدواریم ما را برای پروژه های فریلنسری آینده در نظر داشته باشید. متشکرم!
                                            </span>
                                        </div>
                                    </div>
                                </div> {% endcomment %}
                            </div>
                        </div>
                        <!-- /Invoice --> <!-- Invoice Actions -->
                        <div class="col-xl-3 col-md-4 col-12 invoice-actions">
                            <div class="card">
                                <div class="card-body">
                                    {% if insurance.insurance_file %}
                                    <a class='btn btn-label-secondary d-grid w-100 mb-2' href="{{insurance.insurance_file.url}}" download>دانلود بیمه نامه</a>
                                    {% endif %}
                                
                                    {% if insurance.pay_status == '0' %}
                                    <a class="btn btn-primary d-grid w-100" href="{% url "request" insurance.code %}">
                                        <span class="d-flex align-items-center justify-content-center text-nowrap">
                                            <i class="ti ti-currency-dollar ti-xs me-2"></i>
                                            پرداخت
                                        </span>
                                    </a>
                                    {% endif %}
                                    <br>
                                    <a target='_blank' href="{% url 'generate_pdf' insurance.code %}" class="btn btn-info d-grid w-100" >
                                        <span class="d-flex align-items-center justify-content-center text-nowrap">
                                            <i class="ti ti-download ti-xs me-2"></i>
                                             دانلود زائران
                                        </span>
                                    </a>

                                    {% if insurance.pay_status == "0" %}
                                                                        <br>
                                    <a href="{% url 'remove_insurance' insurance.code %}" class="btn btn-danger d-grid w-100" >
                                        <span class="d-flex align-items-center justify-content-center text-nowrap">
                                            <i class="ti ti-trash ti-xs me-2"></i>
                                             حذف بیمه نامه
                                        </span>
                                    </a>
                                    {% endif %}
                                    
                                </div>
                            </div>
                        </div>
                        <!-- /Invoice Actions -->
                    </div>

                </div>

                <!-- / Footer -->
                <div class="content-backdrop fade"></div>
            </div>

{% endblock %}

{% block page_js %}


{% if messages %}
                    {% for message in messages %}
                    
                    
                    <script>
                        Swal.fire({title: "{{message}}!",icon: "success",draggable: false,});
                         
                    </script>
                        {% endfor %}
                    {% endif %}



{% endblock page_js %}